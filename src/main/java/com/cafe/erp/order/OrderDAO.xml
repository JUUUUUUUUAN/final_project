<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="com.cafe.erp.order.OrderDAO">
    	<select id="selectMaxOrderId" resultType="String">
			select MAX(hq_order_id)
			from order_hq
			where hq_order_id LIKE CONCAT(#{prefix}, #{orderDate}, '%')    	
    	</select>
    	
    	<!-- 발주 추가 -->
    	<insert id="insertOrder" parameterType="OrderDTO">
    		insert into order_hq values(#{hqOrderId}, now(), null, 100, 118001, #{hqOrderTotalAmount});
    	</insert>
    	
    	<!-- 발주 상세 추가 -->
    	<insert id="insertOrderDetail" parameterType="OrderDetailDTO">
    		insert into order_hq_detail 
    		(
    			hq_order_detail_id,
    			hq_order_qty,
    			hq_order_price,
    			hq_order_amount,
    			hq_order_created_at,
    			vendor_code,
    			hq_order_id,
    			item_id,
    			hq_order_item_code,
    			hq_order_item_name
    		)
    		values(null, #{hqOrderQty}, #{hqOrderPrice}, #{hqOrderAmount}, now(), #{vendorCode}, #{hqOrderId}, #{itemId}, #{hqOrderItemCode}, #{hqOrderItemName});
    	</insert>
    	
    	<!-- 발주 목록 요청 -->
    	<select id="listHq" resultType="OrderDTO">
    		select * from order_hq where hq_order_status = 100
    	</select>
    	<select id="listStore" resultType="OrderDTO">
    		select
    			s.store_order_id as hqOrderId,
    			s.store_order_total_amount as hqOrderTotalAmount,
    			s.member_id as memberId,
    			s.store_order_approver as storeOrderApprover,
    			s.store_rejection_reason as storeRejectionReason 
    		from order_store s where store_order_status = 100
    	</select>
    	<!-- 발주 상세 목록 요청 -->
    	<select id="getOrderItems" resultType="OrderDetailDTO">
    		select * from order_hq_detail where hq_order_id = #{orderNo}
    	</select>
    	<!-- 발주 승인 처리 -->
    	<update id="approveOrder" parameterType="String">
    		update order_hq set hq_order_status = 400 where hq_order_id = #{orderNo}
    	</update>
    </mapper>